
// This file is part of CPAchecker,
// a tool for configurable software verification:
// https://cpachecker.sosy-lab.org
//
// SPDX-FileCopyrightText: 2007-2020 Dirk Beyer <https://www.sosy-lab.org>
//
// SPDX-License-Identifier: Apache-2.0

MODULE ROOT Tree
{
  LOCAL
    receive:    SYNC;
    broadcast:  SYNC;
  INST tree FROM Tree1 WITH
  {
    receive  AS broadcast;
    send_ack AS receive;
  }
  INITIAL init;
  AUTOMATON Tree
  {
    STATE init
    {
      TRANS { SYNC broadcast; GOTO await; }
    }
    STATE await
    {
      TRANS { SYNC receive; GOTO done; }
    }
    STATE done(TARGET)
    {
    }
  }
}
MODULE Leaf
{
  INPUT
    receive:   SYNC;
    send_ack:  SYNC;
  INITIAL await;
  AUTOMATON Leaf
  {
    STATE await
    {
      TRANS { SYNC receive; GOTO ack; }
    }
    STATE ack
    {
      TRANS { SYNC send_ack; GOTO await; }
    }
  }
}
MODULE Node
{
  INPUT
    receive:    SYNC;
    send_ack:   SYNC;
    get_ack_1:  SYNC;
    get_ack_2:  SYNC;
    broadcast:  SYNC;
  INITIAL await;
  AUTOMATON Node
  {
    STATE await
    {
      TRANS { SYNC receive; GOTO send; }
    }
    STATE send
    {
      TRANS { SYNC broadcast; GOTO await_ack; }
    }
    STATE await_ack
    {
      TRANS { SYNC get_ack_1; GOTO acked_1; }
      TRANS { SYNC get_ack_2; GOTO acked_2; }
    }
    STATE acked_1
    {
      TRANS { SYNC get_ack_2; GOTO acked_both; }
    }
    STATE acked_2
    {
      TRANS { SYNC get_ack_1; GOTO acked_both; }
    }
    STATE acked_both
    {
      TRANS { SYNC send_ack; GOTO await; }
    }
  }
}
