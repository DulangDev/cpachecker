
// This file is part of CPAchecker,
// a tool for configurable software verification:
// https://cpachecker.sosy-lab.org
//
// SPDX-FileCopyrightText: 2007-2020 Dirk Beyer <https://www.sosy-lab.org>
//
// SPDX-License-Identifier: Apache-2.0

MODULE Sender
{
  INPUT
    propTime:    CONST;
    transmTime:  CONST;
    collDetect:  SYNC;
    begin:       SYNC;
    end:         SYNC;
    busy:        SYNC;
  LOCAL
    x:  CLOCK;
  INITIAL init;
  AUTOMATON Sender
  {
    STATE init
    {
      TRANS
      {
        SYNC collDetect;
        GOTO init;
      }
      TRANS
      {
        RESET x;
        GOTO send;
      }
    }
    STATE send
    {
      INV x = 0;
      TRANS
      {
        SYNC begin;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC busy;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        SYNC collDetect;
        RESET x;
        GOTO collDetected;
      }
    }
    STATE collDetected
    {
      INV x <= propTime;
      TRANS
      {
        SYNC collDetect;
        GOTO collDetected;
      }
      TRANS
      {
        RESET x;
        GOTO send;
      }
    }
    STATE transmit
    {
      INV x <= transmTime;
      TRANS
      {
        SYNC collDetect;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x = transmTime;
        SYNC end;
        RESET x;
        GOTO sent;
      }
    }
    STATE sent(ERROR)
    {
      TRANS
      {
        GOTO init;
      }
    }
  }
}
MODULE ROOT Medium
{
  LOCAL
    propTime = 1:        CONST;
    propTimeDouble = 2:  CONST;
    transmTime = 4:      CONST;
    collDetect:          SYNC;
    x:                   CLOCK;
    begin1:              SYNC;
    end1:                SYNC;
    busy1:               SYNC;
    begin2:              SYNC;
    end2:                SYNC;
    busy2:               SYNC;
    begin3:              SYNC;
    end3:                SYNC;
    busy3:               SYNC;
    begin4:              SYNC;
    end4:                SYNC;
    busy4:               SYNC;
    begin5:              SYNC;
    end5:                SYNC;
    busy5:               SYNC;
    begin6:              SYNC;
    end6:                SYNC;
    busy6:               SYNC;
    begin7:              SYNC;
    end7:                SYNC;
    busy7:               SYNC;
  INST sender_1 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin1;
    end        AS end1;
    busy       AS busy1;
  }
  INST sender_2 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin2;
    end        AS end2;
    busy       AS busy2;
  }
  INST sender_3 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin3;
    end        AS end3;
    busy       AS busy3;
  }
  INST sender_4 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin4;
    end        AS end4;
    busy       AS busy4;
  }
  INST sender_5 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin5;
    end        AS end5;
    busy       AS busy5;
  }
  INST sender_6 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin6;
    end        AS end6;
    busy       AS busy6;
  }
  INST sender_7 FROM Sender WITH
  {
    propTime   AS propTimeDouble;
    transmTime AS transmTime;
    collDetect AS collDetect;
    begin      AS begin7;
    end        AS end7;
    busy       AS busy7;
  }
  INITIAL init;
  AUTOMATON Medium
  {
    STATE init
    {
      TRANS
      {
        SYNC begin1;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC begin2;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC begin3;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC begin4;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC begin5;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC begin6;
        RESET x;
        GOTO transmit;
      }
      TRANS
      {
        SYNC begin7;
        RESET x;
        GOTO transmit;
      }
    }
    STATE transmit
    {
      TRANS
      {
        GUARD x < propTime;
        SYNC begin1;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy1;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end1;
        GOTO init;
      }
      TRANS
      {
        GUARD x < propTime;
        SYNC begin2;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy2;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end2;
        GOTO init;
      }
      TRANS
      {
        GUARD x < propTime;
        SYNC begin3;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy3;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end3;
        GOTO init;
      }
      TRANS
      {
        GUARD x < propTime;
        SYNC begin4;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy4;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end4;
        GOTO init;
      }
      TRANS
      {
        GUARD x < propTime;
        SYNC begin5;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy5;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end5;
        GOTO init;
      }
      TRANS
      {
        GUARD x < propTime;
        SYNC begin6;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy6;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end6;
        GOTO init;
      }
      TRANS
      {
        GUARD x < propTime;
        SYNC begin7;
        RESET x;
        GOTO collDetected;
      }
      TRANS
      {
        GUARD x >= propTime;
        SYNC busy7;
        GOTO transmit;
      }
      TRANS
      {
        SYNC end7;
        GOTO init;
      }
    }
    STATE collDetected
    {
      INV x <= propTime;
      TRANS
      {
        SYNC collDetect;
        GOTO init;
      }
    }
  }
}