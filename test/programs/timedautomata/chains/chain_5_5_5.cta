MODULE Chain
{
  INPUT
    l:    SYNC;
    r:    SYNC;
    fin:  SYNC;
  LOCAL
    x:  CLOCK;
  INITIAL s_0;
  AUTOMATON automaton
  {
    STATE s_0 { TRANS { SYNC l; RESET x; GOTO s_1; } }
    STATE s_1 { TRANS { GUARD x >= 4; SYNC r; GOTO s_2; } }
    STATE s_2 { TRANS { SYNC l; RESET x; GOTO s_3; } }
    STATE s_3 { TRANS { GUARD x >= 4; SYNC r; GOTO s_4; } }
    STATE s_4 { TRANS { SYNC l; RESET x; GOTO s_5; } }
    STATE s_5 { TRANS { SYNC fin; GOTO s_5; } }
  }
}
MODULE ChainGroup
{
  INPUT
    fin:  SYNC;
  LOCAL
    s_0:  SYNC;
    s_1:  SYNC;
    s_2:  SYNC;
    s_3:  SYNC;
    s_4:  SYNC;
    s_5:  SYNC;
  INST proc1 FROM Chain WITH { fin AS fin; l AS s_0; r AS s_1; }
  INST proc2 FROM Chain WITH { fin AS fin; l AS s_1; r AS s_2; }
  INST proc3 FROM Chain WITH { fin AS fin; l AS s_2; r AS s_3; }
  INST proc4 FROM Chain WITH { fin AS fin; l AS s_3; r AS s_4; }
  INST proc5 FROM Chain WITH { fin AS fin; l AS s_4; r AS s_5; }
}
MODULE ROOT System
{
  LOCAL
    fin:  SYNC;
  INST group1 FROM ChainGroup WITH { fin AS fin; }
  INST group2 FROM ChainGroup WITH { fin AS fin; }
  INST group3 FROM ChainGroup WITH { fin AS fin; }
  INST group4 FROM ChainGroup WITH { fin AS fin; }
  INST group5 FROM ChainGroup WITH { fin AS fin; }
  INITIAL start;
  AUTOMATON RunningState
  {
    STATE start { TRANS { SYNC fin; GOTO fin; } }
    STATE fin(ERROR) {  }
  }
}